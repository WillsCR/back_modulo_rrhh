generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model rrhh_departamento {
  id_departamento Int @id @default(autoincrement())

  empleados rrhh_empleado[] @relation("DepartamentoEmpleados")
}

model rrhh_empleado {
  id_empleado      Int      @id @default(autoincrement())
  rut              String   @unique
  nombre           String
  apellido         String
  fecha_ingreso    DateTime
  id_departamento  Int
  estado           String
  fecha_baja       DateTime?
  motivo_baja      String?

  departamento     rrhh_departamento @relation("DepartamentoEmpleados", fields: [id_departamento], references: [id_departamento])
  usuario          rrhh_usuario?
  roles            rrhh_empleado_rol[] @relation("EmpleadoRoles")
  solicitudes      rrhh_solicitud_vacaciones[] @relation("EmpleadoSolicitudes")

  @@index([id_departamento]) // útil para filtrar empleados por departamento
  @@index([estado])          // útil si se consulta frecuentemente por estado
}

model rrhh_usuario {
  id_usuario     Int     @id @default(autoincrement())
  id_empleado    Int     @unique
  email          String  @unique
  password_hash  String
  activo         Boolean @default(true)

  empleado       rrhh_empleado @relation(fields: [id_empleado], references: [id_empleado])
}

model rrhh_rol {
  id_rol        Int     @id @default(autoincrement())
  nombre        String  @unique
  descripcion   String?

  empleados     rrhh_empleado_rol[] @relation("EmpleadoRoles")
}

model rrhh_empleado_rol {
  id_empleado Int
  id_rol      Int

  empleado    rrhh_empleado @relation("EmpleadoRoles", fields: [id_empleado], references: [id_empleado])
  rol         rrhh_rol @relation("EmpleadoRoles", fields: [id_rol], references: [id_rol])

  @@id([id_empleado, id_rol])
  @@index([id_empleado])
  @@index([id_rol])
}

model rrhh_solicitud_vacaciones {
  id_solicitud     Int      @id @default(autoincrement())
  id_empleado      Int
  fecha_inicio     DateTime
  fecha_fin        DateTime
  estado           String // "pendiente", "aprobada", "rechazada"
  fecha_solicitud  DateTime @default(now())
  motivo_rechazo   String?

  empleado         rrhh_empleado @relation("EmpleadoSolicitudes", fields: [id_empleado], references: [id_empleado])

  @@index([id_empleado]) 
  @@index([estado])      
}